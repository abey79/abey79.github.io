<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Annotated Release Notes: vpype 1.13 | bylr.info</title>
<meta name=keywords content="vpype,plotter">
<meta name=description content="vpype 1.13 is out! üéâ
The main improvement is Python 3.11 support, but it does come with a few other bells and whistles, so let&rsquo;s dive in.">
<meta name=author content>
<link rel=canonical href=https://bylr.info/articles/2023/03/13/annotated-release-notes-vpype-1.13/>
<link crossorigin=anonymous href=/assets/css/stylesheet.6c6bbb0265bd99a430fed22493ed8a614c025b8b6da7f1f7b07910f023f53da8.css integrity="sha256-bGu7AmW9maQw/tIkk+2KYUwCW4ttp/H3sHkQ8CP1Pag=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://bylr.info/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://bylr.info/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://bylr.info/favicon-32x32.png>
<link rel=apple-touch-icon href=https://bylr.info/apple-touch-icon.png>
<link rel=mask-icon href=https://bylr.info/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
</noscript><script defer data-domain=bylr.info data-api=https://sta.abeyeler.workers.dev/sta/event src=https://sta.abeyeler.workers.dev/sta/script.js></script><meta property="og:title" content="Annotated Release Notes: vpype 1.13">
<meta property="og:description" content="vpype 1.13 is out! üéâ
The main improvement is Python 3.11 support, but it does come with a few other bells and whistles, so let&rsquo;s dive in.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://bylr.info/articles/2023/03/13/annotated-release-notes-vpype-1.13/"><meta property="og:image" content="https://bylr.info/android-chrome-512x512.png"><meta property="article:section" content="articles">
<meta property="article:published_time" content="2023-03-13T00:00:00+00:00">
<meta property="article:modified_time" content="2023-03-17T00:00:00+00:00"><meta property="og:site_name" content="Antoine Beyeler">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://bylr.info/android-chrome-512x512.png">
<meta name=twitter:title content="Annotated Release Notes: vpype 1.13">
<meta name=twitter:description content="vpype 1.13 is out! üéâ
The main improvement is Python 3.11 support, but it does come with a few other bells and whistles, so let&rsquo;s dive in.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Articles","item":"https://bylr.info/articles/"},{"@type":"ListItem","position":2,"name":"Annotated Release Notes: vpype 1.13","item":"https://bylr.info/articles/2023/03/13/annotated-release-notes-vpype-1.13/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Annotated Release Notes: vpype 1.13","name":"Annotated Release Notes: vpype 1.13","description":"vpype 1.13 is out! üéâ\nThe main improvement is Python 3.11 support, but it does come with a few other bells and whistles, so let\u0026rsquo;s dive in.\n","keywords":["vpype","plotter"],"articleBody":"vpype 1.13 is out! üéâ\nThe main improvement is Python 3.11 support, but it does come with a few other bells and whistles, so let‚Äôs dive in.\nPython 3.11 support  Added support for Python 3.11 and dropped support for Python 3.8 (#581)  Known issue:\n As of PySide 6.4.2, a refresh issue arises on macOS when the viewer window is resized by a window manager (#603)   Python 3.11 was first released on October 22nd, 2022, and the current version is 3.11.2 as of this writing. So it was way overdue for vpype to support it.\nAs usual, adding support for a newer Python means dropping an older one‚Äîbye bye Python 3.8! üëã That said, if you must use Python 3.8, vpype 1.12.1 remains available and has been a rather stable release.\nIn the process of adapting vpype for 3.11, I had to update PySide6 to the last release (6.4.2 as of this writing). Unfortunately, it introduces a refresh glitch on macOS when using a window manager:\nYour browser doesn't support embedded videos, but don't worry, you can download it and watch it with your favorite video player!   I waited for a fix, but this is taking too long, so I opted to make a release with this known issue.\nlid built-in expression variable  Added the lid built-in expression variable for generator and layer processor commands (#605)   Many vpype commands operate on a layer-by-layer basis. They are known as layer processors. One example is the translate command. By default, it appears to run on all layers at once, but what actually happens is that it is run once for each layer. You can control on which layer(s) it should actually run with the --layer option.\nAny expression passed to such a command is also evaluated once per layer. This enables per-layer customisation of the command behaviour. This feature introduces the lid built-in variable, which is set to the ID of the layer that‚Äôs being currently processed.\nHere is an example for illustration:\n$ vpype read file_with_many_layers.svg name \"Layer %lid%\" write output.svg Here, the name command renames all layers (--layer is not used). But since lid is set by vpype to the current layer ID, the output SVG has its layers labelled ‚ÄúLayer 1‚Äù, ‚ÄúLayer 2‚Äù, etc. (the exact numbers depend on the input SVG‚Äôs actual layer structure).\nLayer ID determination  Fixed a design issue with the read command where disjoint groups of digits in layer names could be used to determine layer IDs. Only the first contiguous group of digits is used now, so a layer named ‚Äú01-layer1‚Äù has layer ID of 1 instead of 11 (#606)   Speaking of layer IDs, this fix slightly changes how vpype attributes layer IDs when reading SVGs using the read command. Previously, vpype would strip all non-digit characters from the layer name (or, lacking one, from the corresponding group ID), and use the resulting number as ID, if any. A layer named ‚Äú01-blue3‚Äù would thus end up with ID 13, which is a rather unexpected result! The new behaviour consists of taking the first contiguous group of digit, if any, and use this as layer ID instead. Now, layer ‚Äú01-blue3‚Äù has an ID of 1.\nBTW, I‚Äôm working on a new article on layer names, and how they can be used to control the plotting process with the AxiDraw. So stay tuned for more on this! Done!\nWayland-related crash  Fixed an issue on Wayland-based Linux distributions where using the viewer (e.g. with the show command) would crash (#607)   Qt, the GUI library behind PySide6, has an abstraction layer dedicated to the platform its running on. This is basically what enables Qt projects to seamlessly run on macOS, Linux, or Windows. There appears to be some technicalities involved with this when using OpenGL (as vpype does), which led the viewer to crash on Wayland-based Linux install. The workaround consisted of ‚Äúforcing‚Äù Qt to use the xcb instead of wayland platform by setting an environment variable:\nexport QT_QPA_PLATFORM=xcb With vpype 1.13, this is no longer needed as it automatically sets this environment variable when a Wayland-based Linux is detected.\n","wordCount":"681","inLanguage":"en","datePublished":"2023-03-13T00:00:00Z","dateModified":"2023-03-17T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://bylr.info/articles/2023/03/13/annotated-release-notes-vpype-1.13/"},"publisher":{"@type":"Organization","name":"bylr.info","logo":{"@type":"ImageObject","url":"https://bylr.info/favicon.ico"}}}</script>
</head>
<body id=top>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://bylr.info/ accesskey=h title="bylr.info (Alt + H)">bylr.info</a>
<div class=logo-switches>
</div>
</div>
<ul id=menu>
<li>
<a href=https://bylr.info/about/ title=about>
<span>about</span>
</a>
</li>
<li>
<a href=https://bylr.info/archives title=archives>
<span>archives</span>
</a>
</li>
<li>
<a href=https://bylr.info/tags/ title=tags>
<span>tags</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
Annotated Release Notes: vpype 1.13
</h1>
<div class=post-meta><span title="2023-03-13 00:00:00 +0000 UTC">March 13, 2023</span>&nbsp;¬∑&nbsp;<span title="Last updated 2023-03-17 00:00:00 +0000 UTC">Last updated on March 17, 2023</span>&nbsp;|&nbsp;<a href=https://github.com/abey79/abey79.github.io/blob/main/content/articles/vpype-1.13/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a>
</div>
</header>
<div class=post-content><p><em>vpype</em> 1.13 is out! üéâ</p>
<p>The main improvement is Python 3.11 support, but it does come with a few other bells and whistles, so let&rsquo;s dive in.</p>
<h3 id=python-311-support>Python 3.11 support<a hidden class=anchor aria-hidden=true href=#python-311-support>#</a></h3>
<blockquote class=extract>
<p><ul>
<li>Added support for Python 3.11 and dropped support for Python 3.8 (#581)</li>
</ul>
<p>Known issue:</p>
<ul>
<li>As of PySide 6.4.2, a refresh issue arises on macOS when the viewer window is resized by a window manager (#603)</li>
</ul>
</p>
</blockquote>
<p>Python 3.11 was first released on October 22nd, 2022, and the current version is 3.11.2 as of this writing. So it was way overdue for <em>vpype</em> to support it.</p>
<p>As usual, adding support for a newer Python means dropping an older one&mdash;bye bye Python 3.8! üëã That said, if you <em>must</em> use Python 3.8, <em>vpype</em> 1.12.1 remains available and has been a rather stable release.</p>
<p>In the process of adapting <em>vpype</em> for 3.11, I had to update PySide6 to the last release (6.4.2 as of this writing). Unfortunately, it introduces a <a href=https://bugreports.qt.io/browse/QTBUG-107666>refresh glitch</a> on macOS when using a window manager:</p>
<video preload=auto width=100% autoplay loop playsinline class=html-video>
<source src=/articles/2023/03/13/annotated-release-notes-vpype-1.13/pyside6_glitch.mp4 type=video/mp4>
<span>Your browser doesn't support embedded videos, but don't worry, you can <a href=/articles/2023/03/13/annotated-release-notes-vpype-1.13/pyside6_glitch.mp4>download it</a> and watch it with your favorite video player!</span>
</video>
<br>
<p>I waited for a fix, but this is taking too long, so I opted to make a release with this known issue.</p>
<h3 id=lid-built-in-expression-variable><code>lid</code> built-in expression variable<a hidden class=anchor aria-hidden=true href=#lid-built-in-expression-variable>#</a></h3>
<blockquote class=extract>
<p><ul>
<li>Added the <code>lid</code> built-in expression variable for generator and layer processor commands (#605)</li>
</ul>
</p>
</blockquote>
<p>Many <em>vpype</em> commands operate on a layer-by-layer basis. They are known as <a href=https://vpype.readthedocs.io/en/latest/fundamentals.html#layer-processors>layer processors</a>. One example is the <a href=https://vpype.readthedocs.io/en/latest/reference.html#translate><code>translate</code></a> command. By default, it appears to run on all layers at once, but what actually happens is that it is run once for each layer. You can control on which layer(s) it should actually run with the <code>--layer</code> option.</p>
<p>Any <a href=https://vpype.readthedocs.io/en/latest/fundamentals.html#expression-substitution>expression</a> passed to such a command is <em>also</em> evaluated once per layer. This enables per-layer customisation of the command behaviour. This feature introduces the <code>lid</code> built-in variable, which is set to the ID of the layer that&rsquo;s being currently processed.</p>
<p>Here is an example for illustration:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ vpype  <span style=color:#0086b3>read</span> file_with_many_layers.svg  name <span style=color:#d14>&#34;Layer %lid%&#34;</span>  write output.svg
</code></pre></div><p>Here, the <a href=https://vpype.readthedocs.io/en/latest/reference.html#name><code>name</code></a> command renames all layers (<code>--layer</code> is not used). But since <code>lid</code> is set by <em>vpype</em> to the current layer ID, the output SVG has its layers labelled &ldquo;Layer 1&rdquo;, &ldquo;Layer 2&rdquo;, etc. (the exact numbers depend on the input SVG&rsquo;s actual layer structure).</p>
<h3 id=layer-id-determination>Layer ID determination<a hidden class=anchor aria-hidden=true href=#layer-id-determination>#</a></h3>
<blockquote class=extract>
<p><ul>
<li>Fixed a design issue with the <code>read</code> command where disjoint groups of digits in layer names could be used to determine layer IDs. Only the first contiguous group of digits is used now, so a layer named &ldquo;01-layer1&rdquo; has layer ID of 1 instead of 11 (#606)</li>
</ul>
</p>
</blockquote>
<p>Speaking of layer IDs, this fix slightly changes how <em>vpype</em> attributes layer IDs when reading SVGs using the <a href=https://vpype.readthedocs.io/en/latest/reference.html#read><code>read</code></a> command. Previously, <em>vpype</em> would strip all non-digit characters from the layer name (or, lacking one, from the corresponding group ID), and use the resulting number as ID, if any. A layer named &ldquo;01-blue3&rdquo; would thus end up with ID 13, which is a rather unexpected result! The new behaviour consists of taking the <em>first</em> contiguous group of digit, if any, and use this as layer ID instead. Now, layer &ldquo;01-blue3&rdquo; has an ID of 1.</p>
<p>BTW, I&rsquo;m working on a new article on layer names, and how they can be used to control the plotting process with the AxiDraw. <del>So stay tuned for more on this!</del> <a href=/articles/2023/03/17/layer-names/>Done!</a></p>
<h3 id=wayland-related-crash>Wayland-related crash<a hidden class=anchor aria-hidden=true href=#wayland-related-crash>#</a></h3>
<blockquote class=extract>
<p><ul>
<li>Fixed an issue on Wayland-based Linux distributions where using the viewer (e.g. with the <code>show</code> command) would crash (#607)</li>
</ul>
</p>
</blockquote>
<p><a href=https://www.qt.io>Qt</a>, the GUI library behind PySide6, has an <a href=https://doc.qt.io/qt-6/qpa.html>abstraction layer</a> dedicated to the platform its running on. This is basically what enables Qt projects to seamlessly run on macOS, Linux, or Windows. There appears to be some technicalities involved with this when using OpenGL (as <em>vpype</em> does), which led the viewer to crash on Wayland-based Linux install. The workaround consisted of &ldquo;forcing&rdquo; Qt to use the <code>xcb</code> instead of <code>wayland</code> platform by setting an environment variable:</p>
<div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=color:#0086b3>export</span> <span style=color:teal>QT_QPA_PLATFORM</span><span style=color:#000;font-weight:700>=</span>xcb
</code></pre></div><p>With <em>vpype</em> 1.13, this is no longer needed as it automatically sets this environment variable when a Wayland-based Linux is detected.</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://bylr.info/tags/vpype/>vpype</a></li>
<li><a href=https://bylr.info/tags/plotter/>plotter</a></li>
</ul>
</footer><script src=https://utteranc.es/client.js repo=abey79/abey79.github.io issue-term=pathname label=comments theme=github-light crossorigin=anonymous async></script>
</article>
</main>
<footer class=footer>
<span>¬© 2022-2023 Antoine Beyeler ‚Äì</span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerHTML='copy';function d(){a.innerHTML='copied!',setTimeout(()=>{a.innerHTML='copy'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script>
</body>
</html>